const c=document.getElementById("productosGrid"),u=document.getElementById("busqueda");let r=[],o=[];async function m(){r=await(await fetch("https://fakestoreapi.com/products")).json(),l(r.slice(0,6))}function l(s){c.innerHTML="",s.forEach(e=>{const t=document.createElement("div");t.classList.add("product-card"),t.innerHTML=`
            <img src="${e.image}" alt="${e.title}">
            <h4>${e.title}</h4>
        `,t.addEventListener("click",()=>{o.find(n=>n.id===e.id)?(o=o.filter(n=>n.id!==e.id),t.classList.remove("selected")):o.length<4?(o.push({id:e.id,title:e.title,price:e.price,category:e.category,image:e.image}),t.classList.add("selected")):alert("Máximo 4 productos seleccionados")}),c.appendChild(t)})}u.addEventListener("keyup",s=>{const e=s.target.value.toLowerCase(),t=r.filter(a=>a.title.toLowerCase().includes(e));l(t.slice(0,6))});m();const i=document.getElementById("formularioDatos");i.addEventListener("submit",async s=>{if(s.preventDefault(),o.length===0){Swal.fire({icon:"warning",title:"Selecciona al menos un producto",confirmButtonColor:"#f0ad4e"});return}const e={nombre:document.getElementById("nombre").value,ocupacion:document.getElementById("ocupacion").value,correo:document.getElementById("correo").value,edad:document.getElementById("edad").value,productos:o};try{const a=await(await fetch("/api/contacto",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)})).text();console.log(a);let n;try{n=JSON.parse(a)}catch{console.error("No es JSON:",a)}Swal.fire({icon:"success",title:"¡Perfecto!",text:n.mensaje||"Datos enviados correctamente",confirmButtonColor:"#007bff"}),i.reset(),o=[],document.querySelectorAll(".product-card.selected").forEach(d=>d.classList.remove("selected"))}catch(t){console.error("Error al enviar datos:",t),Swal.fire({icon:"error",title:"Oops...",text:"Hubo un error al enviar los datos",confirmButtonColor:"#d33"})}});
